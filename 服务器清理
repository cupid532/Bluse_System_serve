cat > /tmp/cleanup.sh << 'CLEANUP_SCRIPT_EOF'
#!/bin/bash
# æœåŠ¡å™¨å®Œå…¨æ¸…ç†è„šæœ¬ï¼ˆä¸é‡å¯ç³»ç»Ÿï¼‰
# ç”¨é€”ï¼šæ¸…ç† Dockerã€Dockge åŠæ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€

set -e

echo "=========================================="
CLEANUP_SCRIPT_EOF

chmod +x /tmp/cleanup.sh && /tmp/cleanup.sh
echo "ğŸ§¹ æœåŠ¡å™¨å®Œå…¨æ¸…ç†è„šæœ¬"
echo "=========================================="
echo ""
echo "âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†ï¼š"
echo "   - åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰ Docker å®¹å™¨"
echo "   - åˆ é™¤æ‰€æœ‰ Docker é•œåƒå’Œå·"
echo "   - åˆ é™¤æ‰€æœ‰ Docker ç½‘ç»œ"
echo "   - æ¸…ç† /data ç›®å½•ä¸‹çš„æ‰€æœ‰æ•°æ®"
echo "   - ä¿ç•™ Docker å’Œ Dockge ç¨‹åºæœ¬èº«"
echo ""
read -p "â“ ç¡®è®¤è¦ç»§ç»­å—ï¼Ÿ(è¾“å…¥ YES ç»§ç»­): " confirm

if [ "$confirm" != "YES" ]; then
    echo "âŒ æ“ä½œå·²å–æ¶ˆ"
    exit 0
fi

echo ""
echo "å¼€å§‹æ¸…ç†..."
echo ""

# ============================================
# ç¬¬ 1 æ­¥ï¼šåœæ­¢æ‰€æœ‰å®¹å™¨
# ============================================
echo "ğŸ“¦ [1/8] åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨..."
if [ "$(docker ps -q)" ]; then
    docker stop $(docker ps -q)
    echo "   âœ“ å·²åœæ­¢ $(docker ps -aq | wc -l) ä¸ªå®¹å™¨"
else
    echo "   âœ“ æ— è¿è¡Œä¸­çš„å®¹å™¨"
fi

# ============================================
# ç¬¬ 2 æ­¥ï¼šåˆ é™¤æ‰€æœ‰å®¹å™¨
# ============================================
echo ""
echo "ğŸ—‘ï¸  [2/8] åˆ é™¤æ‰€æœ‰å®¹å™¨..."
if [ "$(docker ps -aq)" ]; then
    docker rm -f $(docker ps -aq)
    echo "   âœ“ å·²åˆ é™¤æ‰€æœ‰å®¹å™¨"
else
    echo "   âœ“ æ— å®¹å™¨éœ€è¦åˆ é™¤"
fi

# ============================================
# ç¬¬ 3 æ­¥ï¼šåˆ é™¤æ‰€æœ‰é•œåƒ
# ============================================
echo ""
echo "ğŸ–¼ï¸  [3/8] åˆ é™¤æ‰€æœ‰ Docker é•œåƒ..."
if [ "$(docker images -q)" ]; then
    docker rmi -f $(docker images -q)
    echo "   âœ“ å·²åˆ é™¤æ‰€æœ‰é•œåƒ"
else
    echo "   âœ“ æ— é•œåƒéœ€è¦åˆ é™¤"
fi

# ============================================
# ç¬¬ 4 æ­¥ï¼šåˆ é™¤æ‰€æœ‰å·
# ============================================
echo ""
echo "ğŸ’¾ [4/8] åˆ é™¤æ‰€æœ‰ Docker å·..."
if [ "$(docker volume ls -q)" ]; then
    docker volume rm -f $(docker volume ls -q) 2>/dev/null || echo "   âš ï¸  éƒ¨åˆ†å·å¯èƒ½æ­£åœ¨ä½¿ç”¨ä¸­"
    echo "   âœ“ å·²åˆ é™¤æ‰€æœ‰å·"
else
    echo "   âœ“ æ— å·éœ€è¦åˆ é™¤"
fi

# ============================================
# ç¬¬ 5 æ­¥ï¼šåˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰ç½‘ç»œ
# ============================================
echo ""
echo "ğŸŒ [5/8] åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰ç½‘ç»œ..."
# ä¿ç•™é»˜è®¤ç½‘ç»œ (bridge, host, none)
CUSTOM_NETWORKS=$(docker network ls --filter type=custom -q)
if [ -n "$CUSTOM_NETWORKS" ]; then
    docker network rm $CUSTOM_NETWORKS 2>/dev/null || echo "   âš ï¸  éƒ¨åˆ†ç½‘ç»œå¯èƒ½æ­£åœ¨ä½¿ç”¨ä¸­"
    echo "   âœ“ å·²åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰ç½‘ç»œ"
else
    echo "   âœ“ æ— è‡ªå®šä¹‰ç½‘ç»œéœ€è¦åˆ é™¤"
fi

# ============================================
# ç¬¬ 6 æ­¥ï¼šæ¸…ç† Docker ç³»ç»Ÿç¼“å­˜
# ============================================
echo ""
echo "ğŸ§½ [6/8] æ¸…ç† Docker ç³»ç»Ÿç¼“å­˜..."
docker system prune -a -f --volumes
echo "   âœ“ å·²æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®"

# ============================================
# ç¬¬ 7 æ­¥ï¼šå¤‡ä»½ /data ç›®å½•ï¼ˆå¯é€‰ï¼‰
# ============================================
echo ""
read -p "ğŸ“ [7/8] æ˜¯å¦å¤‡ä»½ /data ç›®å½•ï¼Ÿ(y/N): " backup_choice
if [[ "$backup_choice" =~ ^[Yy]$ ]]; then
    BACKUP_FILE="/tmp/data_backup_$(date +%Y%m%d_%H%M%S).tar.gz"
    echo "   æ­£åœ¨åˆ›å»ºå¤‡ä»½..."
    tar -czf "$BACKUP_FILE" -C / data 2>/dev/null || echo "   âš ï¸  å¤‡ä»½è¿‡ç¨‹ä¸­æœ‰éƒ¨åˆ†æ–‡ä»¶è·³è¿‡"
    echo "   âœ“ å¤‡ä»½å·²ä¿å­˜åˆ°: $BACKUP_FILE"
    echo "   ğŸ“Š å¤‡ä»½å¤§å°: $(du -h $BACKUP_FILE | cut -f1)"
fi

# ============================================
# ç¬¬ 8 æ­¥ï¼šæ¸…ç† /data ç›®å½•
# ============================================
echo ""
read -p "ğŸ—‚ï¸  [8/8] æ˜¯å¦åˆ é™¤ /data ç›®å½•ï¼Ÿ(y/N): " delete_data
if [[ "$delete_data" =~ ^[Yy]$ ]]; then
    if [ -d "/data" ]; then
        rm -rf /data/*
        echo "   âœ“ å·²æ¸…ç©º /data ç›®å½•å†…å®¹"
        echo "   â„¹ï¸  /data ç›®å½•ä¿ç•™ï¼ˆç©ºæ–‡ä»¶å¤¹ï¼‰"
    else
        echo "   âœ“ /data ç›®å½•ä¸å­˜åœ¨"
    fi
else
    echo "   âŠ˜ å·²è·³è¿‡ /data ç›®å½•æ¸…ç†"
fi

# ============================================
# æ¸…ç† cron ä»»åŠ¡
# ============================================
echo ""
echo "â° [é¢å¤–] æ¸…ç† cron å®šæ—¶ä»»åŠ¡..."
CRON_COUNT=$(crontab -l 2>/dev/null | grep -v "^#" | wc -l)
if [ "$CRON_COUNT" -gt 0 ]; then
    read -p "   å‘ç° $CRON_COUNT ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ˜¯å¦æ¸…ç†ï¼Ÿ(y/N): " clean_cron
    if [[ "$clean_cron" =~ ^[Yy]$ ]]; then
        crontab -r 2>/dev/null || echo "   âš ï¸  æ—  cron ä»»åŠ¡"
        echo "   âœ“ å·²æ¸…ç† cron ä»»åŠ¡"
    else
        echo "   âŠ˜ ä¿ç•™ cron ä»»åŠ¡"
    fi
else
    echo "   âœ“ æ—  cron ä»»åŠ¡éœ€è¦æ¸…ç†"
fi

# ============================================
# æœ€ç»ˆæŠ¥å‘Š
# ============================================
echo ""
echo "=========================================="
echo "âœ… æ¸…ç†å®Œæˆï¼"
echo "=========================================="
echo ""
echo "ğŸ“Š å½“å‰çŠ¶æ€ï¼š"
echo "   - Docker å®¹å™¨: $(docker ps -a | wc -l) ä¸ª (å«è¡¨å¤´)"
echo "   - Docker é•œåƒ: $(docker images | wc -l) ä¸ª (å«è¡¨å¤´)"
echo "   - Docker å·: $(docker volume ls | wc -l) ä¸ª (å«è¡¨å¤´)"
echo "   - Docker ç½‘ç»œ: $(docker network ls | wc -l) ä¸ª (å«è¡¨å¤´)"
echo ""
echo "ğŸ’¿ ç£ç›˜ç©ºé—´ï¼š"
df -h / | tail -1 | awk '{print "   - ç³»ç»Ÿç›˜: "$3" å·²ç”¨ / "$2" æ€»è®¡ ("$5" ä½¿ç”¨ç‡)"}'
if [ -d "/data" ]; then
    df -h /data | tail -1 | awk '{print "   - æ•°æ®ç›˜: "$3" å·²ç”¨ / "$2" æ€»è®¡ ("$5" ä½¿ç”¨ç‡)"}'
fi
echo ""
echo "ğŸ”§ Docker æœåŠ¡çŠ¶æ€ï¼š"
systemctl is-active docker && echo "   - Docker æœåŠ¡: âœ“ è¿è¡Œä¸­" || echo "   - Docker æœåŠ¡: âœ— æœªè¿è¡Œ"
echo ""
echo "ğŸ“ åç»­æ“ä½œå»ºè®®ï¼š"
echo "   1. é‡æ–°æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬"
echo "   2. éƒ¨ç½²æ ¸å¿ƒæœåŠ¡ (Dockge, Caddy)"
echo "   3. æ¢å¤å¤‡ä»½æ•°æ®ï¼ˆå¦‚æœ‰ï¼‰"
echo ""
echo "=========================================="
